<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:fragment="noticeAdminFragment">
	<!--begin::Content container-->
	<div id="kt_app_content_container" class="app-container container-fluid">

		<div class="d-flex flex-column flex-xl-row">
			
			<div class="col-lg-5">
				<div class="card bg-body mb-9 mb-xl-0 me-lg-9">
					<div class="card-body">
						<div class="table-responsive">
							<table id="notice_list_table" class="table align-middle table-row-dashed fs-6 gy-5 dataTable no-footer">
								<thead>
									<tr class="fw-bold fs-6 text-muted">
										<th>제목</th>
										<th>수정</th>
										<th>삭제</th>
									</tr>
								</thead>
								<tbody></tbody>
							</table>
						</div>
						
					</div>
				</div>
			</div>
			
			<div class="col-lg-7">
				<div class="card bg-body mb-9 mb-xl-0 me-lg-9">
					<div class="card-body">
				
						<form id="noticeForm"
							class="form fv-plugins-bootstrap5 fv-plugins-framework" action="#">
	
							<div class="fv-row mb-7 fv-plugins-icon-container">
								<!--begin::Label-->
								<label class="fs-6 fw-bold form-label mt-3">
									<span class="required">제목</span>
									<i class="fas fa-exclamation-circle ms-1 fs-7" data-bs-toggle="tooltip" title=""
										data-bs-original-title="공지사항 제목"
										aria-label="공지사항 제목"></i>
								</label>
								<!--end::Label-->
								<!--begin::Input-->
								<input type="text" class="form-control form-control-solid" name="title" id="title" value="">
								<input type="hidden" class="form-control form-control-solid" name="id" id="id" value="">
								<!--end::Input-->
								<div class="fv-plugins-message-container invalid-feedback"></div>
							</div>
							<!--end::Input group-->
							<!--begin::Input group-->
							<div class="fv-row mb-7">
								<!--begin::Label-->
								<label class="fs-6 fw-bold form-label mt-3">
									<span class="required">내용</span>
									<i class="fas fa-exclamation-circle ms-1 fs-7" data-bs-toggle="tooltip" title=""
										data-bs-original-title="공지사항 내용"
										aria-label="공지사항 내용"></i>
								</label>
								<!--end::Label-->
								<!--begin::Input-->
								<textarea class="form-control form-control-solid" id="content" name="content"></textarea>
								<!--end::Input-->
							</div>
							<!--end::Input group-->
							<!--begin::Separator-->
							<div class="separator mb-6"></div>
							<!--end::Separator-->
							<!--begin::Action buttons-->
							<div class="d-flex justify-content-end">
								<!--begin::Button-->
								<button type="reset" data-kt-contacts-type="cancel"
									class="btn btn-light me-3">취소</button>
								<!--end::Button-->
								<!--begin::Button-->
								<button type="button" id="saveBtn" data-kt-contacts-type="submit" class="btn btn-primary">
									<span class="indicator-label">저장</span>
									<span class="indicator-progress">Please wait...
										<span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
								</button>
								
								<button type="button" id="updateBtn" data-kt-contacts-type="submit" class="btn btn-success d-none">
									<span class="indicator-label">수정</span>
									<span class="indicator-progress">Please wait...
										<span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
								</button>
								<!--end::Button-->
							</div>
						</form>
					</div>
				</div>
			
			</div> <!-- col-lg-7 -->

		</div>

	</div>
	
	<link href="assets/plugins/custom/datatables/datatables.bundle.css" rel="stylesheet" type="text/css" />
	<script src="assets/plugins/custom/datatables/datatables.bundle.js"></script>
	<script type="text/javascript">
	$(document).ready(function () {
		
		const noticeInit = {
			init: function() {
				var _this = this;
				$('#saveBtn').on('click', function(){
					_this.save();	
				});
				
				ajaxCall4Json('/notice/admin/api_v1_002', null, 'post' ,function(result){
					var data = result;
				
					var table = $("#notice_list_table").DataTable({
						"bDestroy": true,
						"order": [],
						"displayLength": 25,
						"data": data,
						"columns": [
							{ data: 'title' },
							{ 
								data: {id: 'id', title: 'title', content: 'content'},  
								render: function (type, data, row) {
									return '<div class="text-center"><button type="button" class="btn btn-sm btn-info saveBtn">수정</button></div>';
								}
							},
							{ 
								data: {id: 'id', title: 'title', content: 'content'},  
								render: function (type, data, row) {
									return '<div class="text-center"><button type="button" class="btn btn-sm btn-danger removeBtn">삭제</button></div>';
								}
							}
						],
						"rowCallback": function (row, data) {
						    var element1 = $(row).find('.saveBtn');
						    element1.on("click", function (e) {
						        
						        $('#id').val(data.id);
						        $('#title').val(data.title);
								$('#content').val(data.content);
						        
						        $('#updateBtn').removeClass('d-none');
						        $('#saveBtn').addClass('d-none');
						        
						        $('#updateBtn').on('click', function(){
									_this.update();	
								});
						    });
						    
						    var element2 = $(row).find('.removeBtn');
						    element2.on("click", function (e) {
						        
						        var conf = confirm('삭제하시겠습니까?');
								if (!conf) return false;
						        
						        $('#id').val(data.id);
						        $('#title').val(data.title);
								$('#content').val(data.content);
						        
								_this.delete();	
						    });
						},
					});
				});
					
			},
			
			save: function() {
				
				var data = {
					title: $('#title').val(),
					content: $('#content').val()	
				};
				
				ajaxCall4Json('/notice/admin/api_v1_001', data, 'post' ,function(result){
					window.location.reload();
				});
			},
			
			update: function() {
				
				var data = {
					id: $('#id').val(),
					title: $('#title').val(),
					content: $('#content').val()	
				};
				
				ajaxCall4Json('/notice/admin/api_v1_003', data, 'post' ,function(result){
					window.location.reload();
				});
					
			},
			
			delete: function() {
				
				var data = {
					id: $('#id').val(),
					title: $('#title').val(),
					content: $('#content').val()	
				};
				
				ajaxCall4Json('/notice/admin/api_v1_004', data, 'post' ,function(result){
					window.location.reload();
				});
			}, 
		};
		
		noticeInit.init();
	});
	</script>
	
</th:block>

</html>