<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<th:block th:fragment="openWaitBuyFragment">
	
	<script src="https://npmcdn.com/flatpickr/dist/flatpickr.min.js"></script>
	<script src="https://npmcdn.com/flatpickr/dist/l10n/ko.js"></script>

	<!--begin::Content container-->
	<div id="kt_app_content_container" class="app-container container-fluid">

		<div class="row gy-5 g-xl-10">
			<!--begin::Col-->
			<div class="col-xl-12 mb-5 mb-xl-5">
				<!--begin::Engage widget 1-->
				<div class="card h-md-100">
					<!--begin::Body-->
					<div class="card-body d-flex flex-column flex-center">
						<!--begin::Heading-->
						<div class="mb-2">
							<!--begin::Title-->
							<h1 class="fw-bold text-gray-800 text-center lh-lg">티켓팅 신청 주의사항
								<br>
								<span class="fw-boldest">신청 전 꼭 읽어주세요</span>
							</h1>
							<!--end::Title-->
						</div>
						<!--end::Heading-->
						<!--begin::Links-->
						<div class="text-center mb-1">
							<!--begin::Link-->
							<a class="btn btn-sm btn-light" href="#">주의사항 확인</a>
							<!--end::Link-->
						</div>
						<!--end::Links-->
					</div>
					<!--end::Body-->
				</div>
				<!--end::Engage widget 1-->
			</div>
			<!--end::Col-->
			
			<!--begin::Col-->
			<div class="col-xl-12 mb-5 mt-xl-5 mb-xl-5">
				<!--begin::Engage widget 1-->
				<div class="card h-md-100">
					
					<div class="card-header border-0">
						<!--begin::Card title-->
						<div class="card-title m-0">
							<h3 class="fw-bolder m-0">티켓팅 신청 - 정보 입력</h3>
							<span th:if="${naverUser != null}">
								<input type="hidden" id="userEmail" th:value="${{naverUser.email}}">
							</span>
							<span th:unless="${naverUser != null}">
								<input type="hidden" id="userEmail" value="">
							</span>
						</div>
						<!--end::Card title-->
					</div>
				
					<!--begin::Body-->
					<div class="card-body p-9">
						
						<div class="row mb-6">
							<!--begin::Label required-->
							<label class="col-lg-4 col-form-label fw-bolder fs-6">공연</label>
							<!--end::Label-->
							<!--begin::Col-->
							<div class="col-lg-8">
								<!--begin::Row-->
								<div class="row">
									<!--begin::Col-->
									<div class="col-lg-12 fv-row fv-plugins-icon-container">
										<input type="text" id="playName" name="playName" class="form-control form-control-lg form-control-flush mb-3 mb-lg-0" readonly th:value="${subject}">
										<div class="fv-plugins-message-container invalid-feedback"></div>
									</div>
									<!--end::Col-->
									
								</div>
								<!--end::Row-->
							</div>
							<!--end::Col-->
						</div>
						
						<div class="row mb-6">
							<!--begin::Label required-->
							<label class="col-lg-4 col-form-label fw-bolder fs-6">예매처</label>
							<!--end::Label-->
							<!--begin::Col-->
							<div class="col-lg-8">
								<!--begin::Row-->
								<div class="row">
									<!--begin::Col-->
									<div class="col-lg-12 fv-row fv-plugins-icon-container">
										<input type="text" id="site" name="site" class="form-control form-control-lg form-control-flush mb-3 mb-lg-0" readonly th:value="${site}">
										<div class="fv-plugins-message-container invalid-feedback"></div>
									</div>
									<!--end::Col-->
									
								</div>
								<!--end::Row-->
							</div>
							<!--end::Col-->
						</div>
						
						<div class="row mb-6">
							<!--begin::Label-->
							<label class="col-lg-4 col-form-label fw-bolder fs-6 required">
							희망일 | 회차
								<i class="fas fa-exclamation-circle ms-1 fs-7" data-bs-toggle="tooltip" title="" data-bs-original-title="희망하는 티켓팅 일자 및 공연회차 입니다."></i>
							</label>
							<!--end::Label-->
							<!--begin::Col-->
							<div class="col-lg-8">
								<!--begin::Row-->
								<div class="row">
									<!--begin::Col-->
									<div class="col-lg-6 fv-row fv-plugins-icon-container">
										<input type="text" id="hopeDay" name="hopeDay" class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 dateSelector" placeholder="희망일자 선택">
										<div class="fv-plugins-message-container invalid-feedback"></div>
									</div>
									
									<div class="col-lg-6 fv-row fv-plugins-icon-container">
										<select id="hopeTime" class="form-select mt-1">
											<option value="1회차">1회차</option>
											<option value="2회차">2회차</option>
											<option value="3회차">3회차</option>
										</select>
										<div class="fv-plugins-message-container invalid-feedback"></div>
									</div>
									<!--end::Col-->
									
								</div>
								<!--end::Row-->
							</div>
							<!--end::Col-->
						</div>
						
						<div class="row mb-6">
							<!--begin::Label required-->
							<label class="col-lg-4 col-form-label fw-bolder fs-6">
								매수
								<i class="fas fa-exclamation-circle ms-1 fs-7" data-bs-toggle="tooltip" title="" data-bs-original-title="2장 이상일 경우, 최대한 가까운 자리로 구매합니다."></i>
							</label>
							<!--end::Label-->
							
							<!--begin::Col-->
							<div class="col-lg-8">
								<!--begin::Row-->
								<div class="row">
									<!--begin::Col-->
									<div class="col-lg-12 fv-row fv-plugins-icon-container">
										<div class="d-flex flex-stack gap-5 mb-3">
									        <button type="button" class="btn btn-sm btn-light-primary w-100" data-kt-docs-advanced-forms="interactive" name="interactive-count">1</button>
									        <button type="button" class="btn btn-sm btn-light-primary w-100" data-kt-docs-advanced-forms="interactive" name="interactive-count">2</button>
									        <button type="button" class="btn btn-sm btn-light-primary w-100" data-kt-docs-advanced-forms="interactive" name="interactive-count">3</button>
									        <button type="button" class="btn btn-sm btn-light-primary w-100" data-kt-docs-advanced-forms="interactive" name="interactive-count">4</button>
									    </div>
									</div>
									<!--end::Col-->
									<input type="number" id="qty" class="form-control form-control-solid" placeholder="필수 1매 이상" name="qty" value="1" readonly />
								</div>
								<!--end::Row-->
							</div>
							<!--end::Col-->
						</div>
						
						<div class="row mb-6">
							<!--begin::Label required-->
							<label class="col-lg-4 col-form-label fw-bolder fs-6">
								좌석
								<i class="fas fa-exclamation-circle ms-1 fs-7" data-bs-toggle="tooltip" title="" data-bs-original-title="좌석 명칭이 다를 경우, 최대한 비슷한 등급으로 티켓팅 합니다."></i>
							</label>
							<!--end::Label-->
							<!--begin::Col-->
							<div class="col-lg-8">
								<!--begin::Row-->
								<div class="row">
									<!--begin::Col-->
									<div class="col-lg-12 fv-row fv-plugins-icon-container">
										
										<div class="d-flex align-items-center mt-3">
											<!--begin::Option-->
											<label class="form-check form-check-inline form-check-solid form-check-danger is-invalid">
												<input class="form-check-input" name="grade" type="radio" value="VIP" checked="checked">
												<span class="fw-bold ps-2 fs-6">VIP등급</span>
											</label>
											<!--end::Option-->
											
											<!--begin::Option-->
											<label class="form-check form-check-inline form-check-solid form-check-success is-invalid">
												<input class="form-check-input" name="grade" type="radio" value="R">
												<span class="fw-bold ps-2 fs-6">R등급</span>
											</label>
											<!--end::Option-->
											
											<!--begin::Option-->
											<label class="form-check form-check-inline form-check-solid is-invalid">
												<input class="form-check-input" name="grade" type="radio" value="S">
												<span class="fw-bold ps-2 fs-6">S등급</span>
											</label>
											<!--end::Option-->
											
											<!--begin::Option-->
											<label class="form-check form-check-inline form-check-solid is-invalid">
												<input class="form-check-input" name="grade" type="radio" value="A">
												<span class="fw-bold ps-2 fs-6">A등급</span>
											</label>
											
											<!--end::Option-->
										</div>
										<input type="text" id="hopeSeat" class="form-control form-control-solid mt-3" placeholder="희망좌석 (예: C열 7번) - 최대한 가까운 자리로 예매합니다." name="hopeSeat" value="" />
									</div>
									<!--end::Col-->
									
								</div>
								<!--end::Row-->
							</div>
							<!--end::Col-->
						</div>
						
						<div class="row mb-6">
							<!--begin::Label-->
							<label class="col-lg-4 col-form-label fw-bolder fs-6 required">
								아이디
								<i class="fas fa-exclamation-circle ms-1 fs-7" data-bs-toggle="tooltip" title="" data-bs-original-title="티켓팅을 위해 예매처 계정 아이디가 필요합니다."></i>
							</label>
							<!--end::Label-->
							<!--begin::Col-->
							<div class="col-lg-8">
								<!--begin::Row-->
								<div class="row">
									<!--begin::Col-->
									<div class="col-lg-12 fv-row fv-plugins-icon-container">
										<input type="text" id="siteId" name="siteId" class="form-control form-control-lg form-control-solid mb-3 mb-lg-0" placeholder="예매처 아이디">
										<div class="fv-plugins-message-container invalid-feedback"></div>
									</div>
									<!--end::Col-->
									
								</div>
								<!--end::Row-->
							</div>
							<!--end::Col-->
						</div>
						
						<div class="row mb-6">
							<!--begin::Label-->
							<label class="col-lg-4 col-form-label fw-bolder fs-6 required">
								비밀번호
								<i class="fas fa-exclamation-circle ms-1 fs-7" data-bs-toggle="tooltip" title="" data-bs-original-title="티켓팅을 위해 예매처 계정 비밀번호가 필요합니다."></i>
							</label>
							<!--end::Label-->
							<!--begin::Col-->
							<div class="col-lg-8">
								<!--begin::Row-->
								<div class="row">
									<!--begin::Col-->
									<div class="col-lg-12 fv-row fv-plugins-icon-container">
										<div class="fv-row" data-kt-password-meter="true">
											
											<div class="position-relative mb-3">
												<input type="password" id="sitePw" name="sitePw" class="form-control form-control-lg form-control-solid mb-3 mb-lg-0" placeholder="예매처 비밀번호">
												
												<span class="btn btn-sm btn-icon position-absolute translate-middle top-50 end-0 me-n2" data-kt-password-meter-control="visibility">
		                							<i class="bi bi-eye-slash fs-2"></i>
		                							<i class="bi bi-eye fs-2 d-none"></i>
		            							</span>
		            							<div class="d-flex align-items-center mb-3" data-kt-password-meter-control="highlight"></div>
											</div>
										</div>
										<div class="fv-plugins-message-container invalid-feedback"></div>
									</div>
									<!--end::Col-->
									
								</div>
								<!--end::Row-->
							</div>
							<!--end::Col-->
						</div>
						
						<div class="row mb-6">
							<!--begin::Label-->
							<label class="col-lg-4 col-form-label fw-bolder fs-6 required">
								연락처
								<i class="fas fa-exclamation-circle ms-1 fs-7" data-bs-toggle="tooltip" title="" data-bs-original-title="티켓팅 성공 후 연락받을 연락처 입니다."></i>
							</label>
							<!--end::Label-->
							<!--begin::Col-->
							<div class="col-lg-8">
								<!--begin::Row-->
								<div class="row">
									<!--begin::Col-->
									<div class="col-lg-12 fv-row fv-plugins-icon-container">
										<input type="text" id="phone" name="phone" class="form-control form-control-lg form-control-solid mb-3 mb-lg-0" placeholder="연락 받을 연락처">
										<div class="fv-plugins-message-container invalid-feedback"></div>
									</div>
									<!--end::Col-->
									
								</div>
								<!--end::Row-->
							</div>
							<!--end::Col-->
						</div>
						
						<div class="row mb-6">
							<!--begin::Label-->
							<label class="col-lg-4 col-form-label fw-bolder fs-6 required">
								생년월일
								<i class="fas fa-exclamation-circle ms-1 fs-7" data-bs-toggle="tooltip" title="" data-bs-original-title="예) 19991231 "></i>
							</label>
							<!--end::Label-->
							<!--begin::Col-->
							<div class="col-lg-8">
								<!--begin::Row-->
								<div class="row">
									<!--begin::Col-->
									<div class="col-lg-12 fv-row fv-plugins-icon-container">
										<input type="text" id="birth" name="birth" class="form-control form-control-lg form-control-solid mb-3 mb-lg-0" placeholder="생년월일 8자리 (예: 19991231)">
										<div class="fv-plugins-message-container invalid-feedback"></div>
									</div>
									<!--end::Col-->
									
								</div>
								<!--end::Row-->
							</div>
							<!--end::Col-->
						</div>
						
						<div class="row mb-6">
							<!--begin::Label-->
							<label class="col-lg-4 col-form-label fw-bolder fs-6 required">
								수고비
								<i class="fas fa-exclamation-circle ms-1 fs-7" data-bs-toggle="tooltip" title="" data-bs-original-title="티켓팅 난이도에 따라 가격이 달라집니다."></i>
							</label>
							<!--end::Label-->
							<!--begin::Col-->
							<div class="col-lg-8">
								<!--begin::Row-->
								<div class="row">
									<!--begin::Col-->
									<div class="col-lg-12 fv-row fv-plugins-icon-container">
										<input type="number" id="applyCost" name="applyCost" class="form-control form-control-lg form-control-solid mb-3 mb-lg-0" placeholder="수고비" value="50000" readonly>
										<div class="fv-plugins-message-container invalid-feedback"></div>
									</div>
									<!--end::Col-->
									
								</div>
								<!--end::Row-->
							</div>
							<!--end::Col-->
						</div>
						
						<div class="row mb-6">
							<!--begin::Label-->
							<label class="col-lg-4 col-form-label fw-bolder fs-6 required">
								환불계좌등록
								<i class="fas fa-exclamation-circle ms-1 fs-7" data-bs-toggle="tooltip" title="" data-bs-original-title="티켓팅 실패 시, 환불 받을 계좌를 등록합니다. "></i>
							</label>
							<!--end::Label-->
							<!--begin::Col-->
							<div class="col-lg-8">
								<!--begin::Row-->
								<div class="row">
									<!--begin::Col-->
									<div class="col-lg-4 fv-row fv-plugins-icon-container">
										<select id="bankName" class="form-select mt-1" aria-label="Select example">
											<option value="국민은행">국민은행</option>
											<option value="기업은행">기업은행</option>
											<option value="농협은행">농협은행</option>
											<option value="새마을금고">새마을금고</option>
											<option value="수협은행">수협은행</option>
											<option value="신한은행">신한은행</option>
											<option value="우리은행">우리은행</option>
											<option value="우체국">우체국</option>
											<option value="저축은행">저축은행</option>
											<option value="하나은행">하나은행</option>
											<option value="한국씨티은행">한국씨티은행</option>
											<option value="SC제일은행">SC제일은행</option>
											<option value="카카오뱅크">카카오뱅크</option>
											<option value="케이뱅크">케이뱅크</option>
											<option value="토스뱅크">토스뱅크</option>
										</select>
									</div>
									<div class="col-lg-5 fv-row fv-plugins-icon-container">
										<input type="text" id="refundAccount" name="refundAccount" class="form-control form-control-lg form-control-solid mb-3 mb-lg-0" placeholder="계좌번호" value="">
										<div class="fv-plugins-message-container invalid-feedback"></div>
									</div>
									<div class="col-lg-3 fv-row fv-plugins-icon-container">
										<input type="text" id="accountOwner" name="accountOwner" class="form-control form-control-lg form-control-solid mb-3 mb-lg-0" placeholder="예금주" value="">
										<div class="fv-plugins-message-container invalid-feedback"></div>
									</div>
									<!--end::Col-->
									
								</div>
								<!--end::Row-->
							</div>
							<!--end::Col-->
						</div>
						
						<div class="row mb-6">
							<!--begin::Label-->
							<label class="col-lg-4 col-form-label fw-bolder fs-6">
								입금방법(계좌이체)
								<i class="fas fa-exclamation-circle ms-1 fs-7" data-bs-toggle="tooltip" title="" data-bs-original-title="입금 확인 후 티켓팅 진행합니다."></i>
							</label>
							<!--end::Label-->
							<!--begin::Col-->
							<div class="col-lg-8">
								<!--begin::Row-->
								<div class="row">
									<!--begin::Col-->
									<div class="col-lg-4 fv-row fv-plugins-icon-container">
										<input type="text" id="depositBank" name="depositBank" class="form-control form-control-lg form-control-flush mb-3 mb-lg-0" value="기업은행" readonly>
									</div>
									<div class="col-lg-5 fv-row fv-plugins-icon-container">
										<input type="text" id="depositAcct" name="depositAcct" class="form-control form-control-lg form-control-flush mb-3 mb-lg-0" value="123-0001-11234421" readonly>
									</div>
									<div class="col-lg-3 fv-row fv-plugins-icon-container">
										<input type="text" class="form-control form-control-lg form-control-flush mb-3 mb-lg-0" value="김*윤" readonly>
										<input type="hidden" id="depositOwner" name="depositOwner" class="form-control form-control-lg form-control-flush mb-3 mb-lg-0" value="김택윤" readonly>
									</div>
									<div class="fv-plugins-message-container invalid-feedback">❗위 계좌로 수고비 입금하면 입금 확인 후 티켓팅 진행합니다.</div>
									<!--end::Col-->
									
								</div>
								<!--end::Row-->
							</div>
							<!--end::Col-->
						</div>
						
					</div>
					<!--end::Body-->
					
					<div class="card-footer d-flex flex-stack flex-wrap py-6 px-9">
						<div class="my-1 me-5">
							<div class="fv-plugins-message-container invalid-feedback">✅ 티켓팅 실패 시, 환불계좌로 전액 환불됩니다.</div>
						</div>
						<button type="button" class="btn btn-primary" id="applyBtn">티켓팅 신청</button>
					</div>
					
				</div>
				<!--end::Engage widget 1-->
			</div>
			<!--end::Col-->
			
		</div>
	</div>
	<!--end::Content container-->

	<script type="text/javascript">
	const options = document.querySelectorAll('[data-kt-docs-advanced-forms="interactive"]');
	const inputEl_qty = document.querySelector('[name="qty"]');
	const inputEl_applyCost = document.querySelector('[name="applyCost"]');
	
	options.forEach(option => {
	    option.addEventListener('click', e => {
	        e.preventDefault();
	        inputEl_qty.value = e.target.innerText;
	        
	        const inputEl_grade = document.querySelector('input[name="grade"]:checked').value;
	        if (inputEl_grade == 'VIP') inputEl_applyCost.value = e.target.innerText * 50000
	        else if (inputEl_grade == 'R') inputEl_applyCost.value = e.target.innerText * 30000
	        else inputEl_applyCost.value = e.target.innerText * 25000
	    });
	});
	
	$(document).ready(function () {
		
		const openWaitInit= {
			
			gradeFn: function () {
				 $("input[name='grade']").on('click', function() {
					var grade = $("input[name='grade']:checked").val();
					var qty = $("#qty").val();
					
					if (grade == 'VIP') $("#applyCost").val(qty * 50000);
					else if (grade == 'R') $("#applyCost").val(qty * 30000);
					else $("#applyCost").val(qty * 25000);
				});
			},
			
			flatpickrInit: function () {
				
				var dateSelector = document.querySelector('.dateSelector');
				flatpickr.localize(flatpickr.l10ns.ko);
				flatpickr(dateSelector);
				
				$("#hopeDay").flatpickr({
					local: 'ko',
					minDate: 'today'
				});
			},
			
			init: function () {

				var _this = this;
					
				const button = document.getElementById('applyBtn');
				button.addEventListener('click', e =>{
				    e.preventDefault();
				
				    Swal.fire({
				        text: "계좌이체 완료 했나요? ",
				        icon: "question",
				        buttonsStyling: false,
				        showCancelButton: true,
				        confirmButtonText: "네! 이체했습니다.",
				        cancelButtonText: '아니요 아직...',
				        customClass: {
				            confirmButton: "btn btn-primary",
				            cancelButton: 'btn btn-danger'
				        }
				    }).then(function(result) {
				      if (result.isConfirmed) {
				        var saveResult = _this.save();
				        if (!saveResult) return false;
				      } else Swal.fire("잠시만요...", "계좌이체 후 티켓팅 신청해주세요.", "error");
				    });
				});
			},
			
			save: function () {
				var data = {
					playName: $('#playName').val().trim(),
					site: $('#site').val().trim(),
					hopeDay: $('#hopeDay').val(),
					hopeTime: $('#hopeTime option:selected').val(),
					qty: $('#qty').val().trim(),
					grade: $('input[name=grade]:checked').val(),
					siteId: $('#siteId').val().trim(),
					sitePw: $('#sitePw').val().trim(),
					phone: $('#phone').val().trim(),
					applyCost: $('#applyCost').val().trim(),
					userEmail: $('#userEmail').val().trim(),
					hopeSeat: $('#hopeSeat').val().trim(),
					birth: $('#birth').val().trim(),
					bankName: $('#bankName option:selected').val(),
					refundAccount: $('#refundAccount').val().trim(),
					accountOwner: $('#accountOwner').val().trim(),
					depositBank: $('#depositBank').val(),
					depositAcct: $('#depositAcct').val(),
					depositOwner: $('#depositOwner').val()
				}
				
				console.log(data);
				
				if (data.userEmail == '') {
					alert('로그인 후 이용해주세요.');
					return false;
				}
				
				if (data.hopeDay == '') {
					alert('희망일자를 선택해주세요.');
					return false;
				}
				
				if (data.qty == '') {
					alert('매수를 입력하세요.');
					return false;
				}
				
				if (data.grade == '') {
					alert('좌석등급을 입력하세요.');
					return false;
				}
				
				if (data.hopeSeat.length > 30) {
					alert('글자 수를 25자 이하로 입력하세요.');
					return false;
				}
				
				if (data.siteId == '') {
					alert('예매처 아이디를 입력하세요.');
					return false;
				}
				
				if (data.sitePw == '') {
					alert('예매처 비밀번호를 입력하세요.');
					return false;
				}
				
				if (data.phone == '') {
					alert('연락처를 입력하세요.');
					return false;
				}
				
				if (data.birth == '') {
					alert('생년월일을 입력하세요.');
					return false;
				}
				
				if (data.refundAccount == '') {
					alert('환불 받을 계좌를 입력하세요.');
					return false;
				}
				
				if (data.accountOwner == '') {
					alert('환불 예금주 이름을 입력하세요.');
					return false;
				}
				
				ajaxCall4Json('/openWait/api_v1_002', data, 'post' ,function(result){
					console.log(result);
					
					if (result != -1) {
						Swal.fire({
				          title: '감사합니다!',
				          html: '입금 확인 후 티켓팅 진행하며<br/>결과는 입력하신 핸드폰 번호로 알려드립니다.',
				          icon: 'success',
				          buttonsStyling: false,
				          confirmButtonText: "확인",
				          customClass: {
				            confirmButton: "btn btn-primary",
				          }
				        }).then(function() {
				          submitPost('/openWaitInvoice', {'reqId': result});
				        });
					} 
					if (result == -1) {
						Swal.fire({
				          title: '신청 중복',
				          html: '신청한 기록이 있습니다.<br/>내정보 - 티켓팅 내역을 확인하세요.',
				          icon: 'warning',
				          buttonsStyling: false,
				          confirmButtonText: "확인",
				          customClass: { confirmButton: "btn btn-primary" }
				        });
					} 
				});
			}
		};
		
		openWaitInit.init();
		openWaitInit.gradeFn();
		openWaitInit.flatpickrInit();
	})
	</script>

</th:block>

</html>